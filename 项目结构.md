# 项目结构分析

## 1. 项目简介

这是一个基于 **Electron** 和 **Vue 3** 构建的 Bilibili 桌面端播放器。它通过 Electron 封装 Bilibili 网页版，并提供了本地化的增强功能，如全局快捷键、书签管理、自定义设置和样式注入等。

**主要技术栈：**
- **Core**: Electron (Main Process)
- **Frontend**: Vue 3 + Vite (Renderer Process)
- **Dependencies**: `uiohook-napi` (全局快捷键), `electron-builder` (打包)

## 2. 目录结构

### 根目录
- `electron/`: Electron 主进程代码
- `src/`: Vue 前端渲染进程代码
- `dist/`, `dist-electron/`: 构建输出目录
- `release/`: 打包后的安装包输出目录
- `package.json`: 项目依赖与脚本配置
- `vite.config.js`: Vite 构建配置

### 详细结构

#### `electron/` (主进程)
- **`main/`**: 核心逻辑
    - `main.js`: 主进程入口，负责窗口创建和生命周期管理。
    - `bilibiliController.js`: 控制 Bilibili 播放器页面的交互逻辑。
    - `bookmarkManager.js`: 书签数据的增删改查与持久化。
    - `configManager.js`: 用户配置的加载、保存与管理。
    - `hotkeys.js`: 注册和处理全局快捷键。
    - `ipcHandlers.js`: 处理渲染进程与主进程之间的 IPC 通信。
    - `styleInjector.js`: 负责向 Bilibili 页面注入自定义 CSS。
    - `trayManager.js`: 系统托盘图标与菜单管理。
- **`preload/`**: 预加载脚本，用于在页面中暴露 Node.js 能力。
- **`assets/`**: 静态资源（图标等）。

#### `src/` (渲染进程)
- `main.js`: Vue 应用入口。
- `app.vue`: 根组件。
- `style.css`: 全局样式。
- **`components/`**: UI 组件
    - `BookmarkList.vue`: 书签列表展示与交互。
    - `MenuBar.vue`: 自定义顶部菜单栏。
    - `SettingsModal.vue`: 设置弹窗界面。
    - `ToastManager.vue`: 消息通知组件。
- **`utils/`**: 工具函数
    - `injectionScripts.js`: 可能包含注入到页面的辅助脚本。

## 3. 功能模块

| 模块 | 描述 | 关键文件 |
| :--- | :--- | :--- |
| **播放控制** | 封装 Bilibili 网页，提供无框窗口体验。 | `bilibiliController.js` |
| **配置管理** | 管理用户偏好（快捷键、主题等），持久化存储。 | `configManager.js` |
| **书签系统** | 本地保存视频播放进度和信息，支持增删改查。 | `bookmarkManager.js`, `BookmarkList.vue` |
| **快捷键** | 支持系统级全局快捷键（如控制播放/暂停）。 | `hotkeys.js` |
| **样式注入** | 允许修改 Bilibili 网页的 CSS 样式。 | `styleInjector.js` |
| **IPC 通信** | 前后端数据交互桥梁。 | `ipcHandlers.js` |

## 4. 数据结构

### 4.1 用户配置 (`config.json`)
存储位置: `~/.bilibili-player/config.json` (用户主目录)

```json
{
  "pauseKey": "`",       // 暂停/播放快捷键
  "backKey": "5",        // 快退快捷键
  "forwardKey": "6",     // 快进快捷键
  "seekSeconds": 3,      // 快进/快退秒数
  "themeStyle": "default" // 主题样式
}
```

### 4.2 书签数据 (`bookmarks.json`)
存储位置: `~/.bilibili-player/bookmarks.json` (与配置文件同目录)

**数据模型:**
```javascript
[
  {
    "id": "1705651234567",       // 唯一ID (时间戳字符串)
    "bv": "BV1xx411c7x",         // 视频 BV 号
    "page": 1,                   // 分P号
    "title": "视频标题",          // (推测)
    "currTime": 120,             // (推测) 当前播放进度
    "totalTime": 300,            // (推测) 总时长
    "createdAt": 1705651234567   // 创建时间戳
    // ... 其他视频元数据
  }
]
```
*注：书签的具体字段由 `addBookmark` 方法传入的对象决定，但 ID 和 createdAt 是自动生成的。*
